

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>User Guide &mdash; Bodo 0+untagged.2811.ga20080c.dirty documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Supported Pandas Operations" href="supportedpandas.html" />
    <link rel="prev" title="Overview" href="overview.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Bodo
          

          
          </a>

          
            
            
              <div class="version">
                0+untagged.2811
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#automatic-parallelization">Automatic Parallelization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-distribution">Data Distribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#argument-and-return-variables">Argument and Return Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#distribution-report">Distribution Report</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#explicit-parallel-loops">Explicit Parallel Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="#file-i-o">File I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="#print">Print</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parallel-apis">Parallel APIs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="supportedpandas.html">Supported Pandas Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="numpy_supported.html">Supported Numpy Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="notsupported.html">Not Supported Python Programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="aws.html">AWS Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="jupyter.html">Jupyter Notebook Setup</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Bodo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>User Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/source/supported.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="user-guide">
<span id="supported"></span><h1>User Guide<a class="headerlink" href="#user-guide" title="Permalink to this headline">¶</a></h1>
<p>Bodo supports a subset of Python that is commonly used for
data analytics and machine learning. This section describes this subset
and explains how parallelization is performed.
The supported data structures for parallel/distributed datasets
are <a class="reference external" href="http://www.numpy.org/">Numpy</a> arrays, and
<a class="reference external" href="http://pandas.pydata.org/">Pandas</a> Dataframe, Series and Index objects.</p>
<div class="section" id="automatic-parallelization">
<h2>Automatic Parallelization<a class="headerlink" href="#automatic-parallelization" title="Permalink to this headline">¶</a></h2>
<p>Bodo parallelizes programs automatically based on the <cite>map-reduce</cite> parallel
pattern. Put simply, this means the compiler analyzes the program to
determine whether each parallelizable data structure and operation should
be distributed or not. This analysis uses the semantics of operations as
the program below demonstrates:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@bodo</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">example_1D</span><span class="p">():</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s2">&quot;data.h5&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">][:]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
<p>This program reads a one-dimensional array called <cite>A</cite> from file and sums its
values. Array <cite>A</cite> is the output of an I/O operation and is input to <cite>np.sum</cite>.
Based on semantics of I/O and <cite>np.sum</cite>, Bodo determines that <cite>A</cite> can be
distributed since I/O can output a distributed array and <cite>np.sum</cite> can
take a distributed array as input.
In <cite>map-reduce</cite> terminology, <cite>A</cite> is output of a <cite>map</cite> operator and is input
to a <cite>reduce</cite> operator. Hence,
Bodo distributes <cite>A</cite> and all operations associated with <cite>A</cite>
(i.e. I/O and <cite>np.sum</cite>) and generates a parallel binary.
This binary replaces the <cite>example_1D</cite> function in the Python program
automatically.</p>
<p>Bodo can only analyze and parallelize the supported data-parallel operations of
Numpy and Pandas (listed in this manual).
Hence, only the supported operations can be
used for distributed datasets and computations.
The sequential computation on other data structures can be any code that
<a class="reference external" href="http://numba.pydata.org/numba-doc/latest/index.html">Numba supports</a>.</p>
<div class="section" id="data-distribution">
<h3>Data Distribution<a class="headerlink" href="#data-distribution" title="Permalink to this headline">¶</a></h3>
<p>Data is distributed in one-dimensional block (<cite>1D_Block</cite>) manner
among processors by default. This means that processors own equal
chunks of each distributed array, DataFrame or Series,
except possibly the last processor.
Dataframes and multi-dimensional arrays are distributed along their
first dimension.
For example, chunks of rows are distributed for dataframes and 2D matrices.
The figure below illustrates the distribution of a 9-element
one-dimensional Numpy array, as well
as a 9 by 2 array, on three processors:</p>
<a class="reference internal image-reference" href="../_images/dist.jpg"><img alt="distribution of 1D array" class="align-center" src="../_images/dist.jpg" style="width: 300.0px; height: 300.0px;" /></a>
<p>Bodo replicates the arrays that are not distributed.
This is called <cite>REP</cite> distribution for consistency.</p>
</div>
<div class="section" id="argument-and-return-variables">
<h3>Argument and Return Variables<a class="headerlink" href="#argument-and-return-variables" title="Permalink to this headline">¶</a></h3>
<p>Bodo assumes argument and return variables to jitted functions are
replicated. However, the user can annotate these variables to indicate
distributed data. In this case,
the user is responsile for handling of the distributed data chunks outside
the Bodo scope. For example, the data can come from other jitted functions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@bodo</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">distributed</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">})</span>
<span class="k">def</span> <span class="nf">example_return</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">A</span>

<span class="nd">@bodo</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">distributed</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;B&#39;</span><span class="p">})</span>
<span class="k">def</span> <span class="nf">example_arg</span><span class="p">(</span><span class="n">B</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">B</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">example_return</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">example_arg</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="distribution-report">
<h3>Distribution Report<a class="headerlink" href="#distribution-report" title="Permalink to this headline">¶</a></h3>
<p>The distributions found by Bodo can be printed either by setting
<cite>BODO_DISTRIBUTED_DIAGNOSTICS=1</cite> or calling <cite>distributed_diagnostics()</cite>
on the compiled function. For example, consider example code below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@bodo</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">example_1D</span><span class="p">():</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s2">&quot;data.h5&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">][:]</span>
    <span class="k">return</span> <span class="n">A</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="n">example_1D</span><span class="p">()</span>
<span class="n">example_1D</span><span class="o">.</span><span class="n">distributed_diagnostics</span><span class="p">()</span>
</pre></div>
</div>
<p>Here is the diagnostics output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Distributed diagnostics for function example_1D, ../s.py (7)

Data distributions:
$A.39.101            1D_Block

Parfor distributions:
0                    1D_Block

Distributed listing for function example_1D, ../s.py (7)
-----------------------------------------------------| parfor_id/variable: distribution
@bodo.jit                                            |
def example_1D():                                    |
    f = h5py.File(&quot;bodo/tests/data/lr.hdf5&quot;, &quot;r&quot;)    |
    A = f[&#39;responses&#39;][:]                            |
    return A.sum()-----------------------------------| #0: 1D_Block
</pre></div>
</div>
<p>This report suggests that the function has an array that is distributed in
1D_Block fashion. The variable name is renamed from <cite>A</cite> to <cite>$A.39.101</cite> through
the optimization passes. The report also suggests that there is a <cite>parfor</cite>
(data-parallel for loop) that is 1D_Block distributed.</p>
</div>
</div>
<div class="section" id="explicit-parallel-loops">
<h2>Explicit Parallel Loops<a class="headerlink" href="#explicit-parallel-loops" title="Permalink to this headline">¶</a></h2>
<p>Sometimes explicit parallel loops are required since a program cannot be
written in terms of data-parallel operators easily.
In this case, one can use Bodo’s <code class="docutils literal notranslate"><span class="pre">prange</span></code> in place of <code class="docutils literal notranslate"><span class="pre">range</span></code> to specify
that a loop can be parallelized. The user is required to make sure the
loop does not have cross iteration dependencies except for supported
reductions.</p>
<p>The example below demonstrates a parallel loop with a reduction:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bodo</span> <span class="k">import</span> <span class="n">jit</span><span class="p">,</span> <span class="n">prange</span>
<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">prange_test</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">ranf</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">s</span>
</pre></div>
</div>
<p>Currently, reductions using <code class="docutils literal notranslate"><span class="pre">+=</span></code>, <code class="docutils literal notranslate"><span class="pre">*=</span></code>, <code class="docutils literal notranslate"><span class="pre">min</span></code>, and <code class="docutils literal notranslate"><span class="pre">max</span></code> operators are
supported.</p>
</div>
<div class="section" id="file-i-o">
<h2>File I/O<a class="headerlink" href="#file-i-o" title="Permalink to this headline">¶</a></h2>
<p>Currently, Bodo supports I/O for <a class="reference external" href="http://parquet.apache.org/">Parquet</a>,
CSV, Numpy binaries and <a class="reference external" href="http://www.h5py.org/">HDF5</a> formats.</p>
<p>For Parquet and CSV, the syntax is the same as Pandas:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@bodo</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">example_pq</span><span class="p">():</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;example.pq&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For HDF5, the syntax is the same as the <a class="reference external" href="http://www.h5py.org/">h5py</a> package.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@bodo</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">example_h5</span><span class="p">():</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s2">&quot;data.hdf5&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">][:]</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;responses&#39;</span><span class="p">][:]</span>
</pre></div>
</div>
<p>Numpy’s <cite>fromfile</cite> and <cite>tofile</cite> are supported as below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@bodo</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">example_np_io</span><span class="p">():</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="s2">&quot;myfile.dat&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="n">A</span><span class="o">.</span><span class="n">tofile</span><span class="p">(</span><span class="s2">&quot;newfile.dat&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Bodo automatically parallelizes I/O of different nodes in a distributed setting
without any code changes.</p>
<p>Bodo needs to know the types of input arrays. If the file name is a constant
string, Bodo tries to look at the file at compile time and recognize the types.
Otherwise, the user is responsile for providing the types similar to
<a class="reference external" href="http://numba.pydata.org/numba-doc/latest/reference/types.html">Numba’s typing syntax</a>. For
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@bodo</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="nb">locals</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;df&#39;</span><span class="p">:{</span><span class="s1">&#39;one&#39;</span><span class="p">:</span> <span class="n">bodo</span><span class="o">.</span><span class="n">float64</span><span class="p">[:],</span>
                  <span class="s1">&#39;two&#39;</span><span class="p">:</span> <span class="n">bodo</span><span class="o">.</span><span class="n">string_array_type</span><span class="p">,</span>
                  <span class="s1">&#39;three&#39;</span><span class="p">:</span> <span class="n">bodo</span><span class="o">.</span><span class="n">bool_</span><span class="p">[:],</span>
                  <span class="s1">&#39;four&#39;</span><span class="p">:</span> <span class="n">bodo</span><span class="o">.</span><span class="n">float64</span><span class="p">[:],</span>
                  <span class="s1">&#39;five&#39;</span><span class="p">:</span> <span class="n">bodo</span><span class="o">.</span><span class="n">string_array_type</span><span class="p">,</span>
                  <span class="p">}})</span>
<span class="k">def</span> <span class="nf">example_df_schema</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>


 <span class="nd">@bodo</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="nb">locals</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">bodo</span><span class="o">.</span><span class="n">float64</span><span class="p">[:,:],</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="n">bodo</span><span class="o">.</span><span class="n">float64</span><span class="p">[:]})</span>
 <span class="k">def</span> <span class="nf">example_h5</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
     <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
     <span class="n">X</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">][:]</span>
     <span class="n">Y</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;responses&#39;</span><span class="p">][:]</span>
</pre></div>
</div>
</div>
<div class="section" id="print">
<h2>Print<a class="headerlink" href="#print" title="Permalink to this headline">¶</a></h2>
<p>Bodo assigns <cite>REP</cite> to distributable arguments of <code class="docutils literal notranslate"><span class="pre">print</span></code> functions
(to make sure values are identical on all processors) and prints values
only once instead of one print per process. The intention is to avoid
unexpected behavior, especially when running on large number of processors.
Programmers can use <cite>bodo.parallel_print</cite> for printing distributed chunks of
data or parallel prints of other values.</p>
</div>
<div class="section" id="parallel-apis">
<h2>Parallel APIs<a class="headerlink" href="#parallel-apis" title="Permalink to this headline">¶</a></h2>
<p>Bodo provides a limited number of parallel APIs to
support advanced cases that may need them.</p>
<ul class="simple">
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">bodo.get_rank()</span></code> Get the rank of the process (same as <cite>MPI_Comm_rank</cite>).</p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">bodo.get_size()</span></code> Get the number of processes (same as <cite>MPI_Comm_size</cite>).</p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">bodo.barrier()</span></code> Blocks until all processes have reached this call
(same as <cite>MPI_Barrier</cite>).</p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">bodo.gatherv()</span></code> Gathers all data chunks into process 0
(same as <cite>MPI_Gatherv</cite>).</p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">bodo.allgatherv()</span></code> Gathers all data chunks and delivers to all processes
(same as <cite>MPI_Allgatherv</cite>).</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="supportedpandas.html" class="btn btn-neutral float-right" title="Supported Pandas Operations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="overview.html" class="btn btn-neutral float-left" title="Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Bodo, Inc.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>